<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta HTTP-EQUIV="pragma" CONTENT="no-cache">
    <title>虚拟网络映射系统</title>
    <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
	<script src="https://cdn.staticfile.org/echarts/4.3.0/echarts.min.js"></script>
    <script src="js/bootstrap-paginator.min.js"></script>
    <script type="text/javascript">
        $.ajaxSetup({
            cache: false // 关闭ajax缓存
        });
        document.write("<script type='text/javascript' src='js/commicate.js?time="+new Date().getTime()+"'></s"+"cript>");
        document.write("<script type='text/javascript' src='js/domprocess.js?time="+new Date().getTime()+"'></s"+"cript>");
        document.write("<link rel='stylesheet' href='css/index.css?time=" + new Date().getTime() + "'/>");
        // 引入组件
        $(document).ready(function () {
            $('#handleAnalyze').load('html/handleAnalyze.html');
            $('#oneStage').load('html/oneStage.html');
            $('#twoStage').load('html/twoStage.html');
            $('#compareResult').load('html/compareResult.html');
            $('#loginModal').load('html/login.html');
        })
    </script>
</head>
<body style="background-color: #000" onload="init()">
<!-- 导航栏 -->
<div id="navigate">
    <nav class="navbar navbar-inverse" role="navigation">
        <div class="container-fluid">
            <div class="navbar-header col-md-2" data-toggle="modal" data-target="#handle">
                <a class="navbar-brand" href="#">手动分析</a>
            </div>
            <div class="navbar-header col-md-2" data-toggle="modal" data-target="#experiment1">
                <a class="navbar-brand" href="#">一阶段实验</a>
            </div>
            <div class="navbar-header col-md-2" data-toggle="modal" data-target="#experiment2">
                <a class="navbar-brand" href="#">二阶段协调实验</a>
            </div>
            <form class="navbar-form navbar-left col-md-3 col-md-push-2" role="search">
                <div class="form-group">
                    <input type="text" class="form-control" placeholder="Search Tasks">
                </div>
                <button type="submit" class="btn btn-primary">搜索</button>
                <div id="loginStatus" style="display: inline">
                    <!--<button style="margin-left: 10px">登录</button>-->
                </div>
                <button>帮助</button>
            </form>
        </div>
    </nav>
</div>
<!-- 超大屏幕 -->
<div class="jumbotron" style="height: 575px;background-color: rgb(30,41,61);color: #fff;margin-top: -22px;font-size: 16px;margin-bottom: 0px">
    <div class="container">
        <h3 style="margin-left: -50px;margin-top: -30px;margin-bottom: 20px;color: rgb(36,169,225)">任务队列</h3>
        <table style="width: 100%;" id="tab"></table>
        <ul class="pagination" id="pagination"></ul>
    </div>
</div>
<!-- 手动分析模态框 -->
<div id="handleAnalyze"></div>
<!-- 一阶段实验模态框 -->
<div id="oneStage"></div>
<!-- 二阶段协调阶段实验模态框 -->
<div id="twoStage"></div>
<!-- 实验对比查看 -->
<div id="compareResult"></div>
<!--登陆页面-->
<div id="loginModal"></div>
<!-- 底边栏 -->
<div id="footer">
    <div class="" align="center" style="vertical-align: center; margin-top: 10px; color: rgb(248,232,137)">
        虚拟网络映射原型系统，所有权利保留&copy;
    </div>
</div>
</body>

<!-- 处理函数 -->
<script type="text/javascript">
    var interval_handle; // 全局定时器句柄
    var tabDom = document.getElementById('tab');
    function submit_handle() {
        var doc = document.getElementById("handle_analyze");
		var formData = new FormData(doc);
		RequestPostVoid("http://localhost:8080/analyze/handle", formData, function () {
		    flush(true);
        });
        // 擦除数据
        $('#handle').modal('hide');
        $('#handle').on('hidden.bs.modal', function () {
            doc.reset();
        })
    }

    function init() {
        checkCookie();
        RequestGetPageWithDes(tabDom, 'http://localhost:8080/fetch?pageNo=0', function (data) {
            console.log(JSON.stringify(data));
            taskQueueUpdate(document.getElementById('tab'), data);
            flush(data['autoFlush']);
            var total = Math.max(Math.ceil(data['total'] / 10), 1);
            renderPagination($('#pagination'), total, function (event, oldPage, newPage) {
                RequestGetPage(tabDom, 'http://localhost:8080/fetch?pageNo='+(newPage - 1), function (data) {
                    console.log(JSON.stringify(data));
                    taskQueueUpdate(document.getElementById('tab'), data);
                    flush(data['autoFlush']);
                })
            });
        });
    }

    // 自动刷新
    function flush(f) {
        if (f) {
            // 获取当前页
            var current = $('#pagination').bootstrapPaginator("getPages")['current']
            RequestGetPage(tabDom, 'http://localhost:8080/fetch?pageNo=' + (current - 1), function (data) {
                console.log(JSON.stringify(data));
                taskQueueUpdate(document.getElementById('tab'), data);
                if (data['autoFlush']) {
                    // 继续调用
                    interval_handle = setTimeout("flush(true)", 1000);
                } else {
                    clearInterval(interval_handle);
                }
            })
        }
    }

    // 删除id对应的请求
    function deleteRequest(id) {
        RequestPostX('http://localhost:8080/remove', {id: id}, function (data) {
            // data中有msg字段
            alert(data['msg']);
            flush(true);
        });
    }

    // 获取请求的参数
    function getArguments(id) {
        RequestGetX('http://localhost:8080/arguments', {id: id}, function (data) {
            if (data['msg'] != null) {
                alert(data['msg']);
            } else {
                alert(JSON.stringify(data));
            }
        })
    }

    // 下载结果
    function download(id) {
        var url = "http://localhost:8080/download";
        var form = $("<form></form>").attr("action", url).attr("method", "post");
        form.append($("<input></input>").attr("type", "hidden").attr("name", "id").attr("value", id));
        form.appendTo('body').submit().remove();
    }

    function checkCookie() {
        // 进行登录操作，在初始化的时候，检测cookie中是否存在用户名和密码，如果存在那么视为自动登陆成功，按钮文字显示注销
        // 否则显示登录。登录时候，如果可以从数据中找到用户，那么则登录成功；否则登录失败。此时修改用户uid为指定的为hash的结果
        // session, session默认保存为一天
        var ck = document.cookie;
        var ckarray = ck.split(';');
        var msg = '登录';
        for (var i in ckarray) {
            if (ckarray[0] == "") {
                // 不存在cookie
                break;
            }
            var key = ckarray[i].split('=')[0].trim();
            var value = ckarray[i].split('=')[1].trim();
            if (key == 'uid_' && value.indexOf('session_') > -1) {
                // 说明登录过
                msg = '注销';
            }
        }
        var dom = document.getElementById('loginStatus');
        if (msg == '登录') {
            dom.innerHTML = '<button style="margin-left: 10px" data-toggle="modal" data-target="#loginPage">登录</button>';
        } else {
            dom.innerHTML = '<button style="margin-left: 10px" onclick="login(\'logout\')">注销</button>';
        }
    }

    function login(type) {
        if (type == 'login' || type == 'register') {
            if ($('input[name="username"]').val() == '' || $('input[name="passwod"]').val() == '') {
                alert((type == 'login' ? '登录' : '注册') + '用户名和密码都不能为空');
                return;
            }
            $('#type').attr('value', type); // 赋值
            RequestPostX('http://localhost:8080/login', $('#loginForm').serialize(), function (data) {
                alert(data.msg);
                if (type == 'login' && data.msg == '用户登录成功') {
                    // 关闭模态框
                    $('#loginPage').modal('hide');
                    // 刷新页面
                    checkCookie();
                    flush(true);
                } else if (type == 'register' && data.msg.indexOf('用户名已存在') > -1) {
                    // 清空
                    document.getElementById('loginForm').reset();
                    $('input[name="username"]').focus();
                }
            });
        } else if (type == 'logout') {
            // 注销
            RequestPostX('http://localhost:8080/login', {type : type}, function (data) {
                alert(data.msg);
                if (data.msg == '用户注销成功') {
                    // 刷新页面
                    checkCookie();
                    flush(true);
                }
            })
        }
    }

    function submit_onestage() {
        var doc = document.getElementById("onestage_analyze");
        RequestPostXVoid("http://localhost:8080/handle/onestage", $("#onestage_analyze").serialize(), function () {
            flush(true);
        });
        // 擦除数据
        $('#experiment1').modal('hide');
        $('#experiment1').on('hidden.bs.modal', function () {
            doc.reset();
        })
    }

    function submit_twostage() {
        var doc = document.getElementById("twostage_analyze");
        RequestPostXVoid("http://localhost:8080/handle/twostage", $("#twostage_analyze").serialize(), function () {
            flush(true);
        });
        // 擦除数据
        $('#experiment2').modal('hide');
        $('#experiment2').on('hidden.bs.modal', function () {
            doc.reset();
        })
    }

    function look(id) {
        // 打开Echarts框
//        $("#look").modal("show");
//        setTimeout("open_chart()", 100);
        RequestGetX("http://localhost:8080/look", {id: id}, function (data) {
//            alert(JSON.stringify(data));
            $("#look").modal("show");
            setTimeout(function () {
                ar = data["snodes"].split("-");
                xAxis = []
                for (var i = parseInt(ar[0]); i < parseInt(ar[1]); i+= parseInt(ar[2])) {
                    xAxis.push(i.toString());
                }
                legend = [];
                if (data["RCRGF"] == 1) {
                    legend.push("RCRGF");
                }
                if (data["SubgraphIsomorphism"] == 1) {
                    legend.push("SubgraphIsomorphism");
                }
                if (data["Greedy"] == 1) {
                    legend.push("Greedy");
                }
                var myChart = echarts.init(document.getElementById('graph'));
                option = oneStageEchartsOptionTemplate(xAxis, legend, data["RE"], data["RA"], data["RR"],
                    data["SE"], data["SA"], data["SR"], data["GE"], data["GA"], data["GR"]);
                myChart.setOption(option);
            }, 100);
        })
    }

//	$('#look').on('show.bs.modal', function() {
//
//	})

    function oneStageEchartsOptionTemplate(xAxis, legend, RE, RA, RR, SE, SA, SR, GE, GA, GR) {
        option = {
            grid: [
                {x: '14%', y: '10%', width: '38%', height: '30%'},
                {x2: '0%', y: '27%', width: '40%', height: '50%'},
                {x: '14%', y2: '10%', width: '38%', height: '30%'},
            ],
            tooltip: {
                formatter: '{a}: ({c})'
            },
            xAxis: [
                {gridIndex: 0, boundaryGap: false, data: xAxis, type: 'category'},
                {gridIndex: 1, boundaryGap: false, data: xAxis, type: 'category'},
                {gridIndex: 2, boundaryGap: false, data: xAxis, type: 'category'},
            ],
            yAxis: [
                {gridIndex: 0, name: 'Acceptance Ratio'}, // y坐标系0-15
                {gridIndex: 1, name: 'Execution Time(ms)'},
                {gridIndex: 2, name: 'RevenueToCost Ratio'},
            ],
            legend: {
                left: 'right',
                data: legend
            },
            series: [
                {
                    name: 'RCRGF',
                    type: 'line',
                    itemStyle : {
                        normal : {
                            color:'#FF0000',  // 红色
                            lineStyle:{
                                color:'#FF0000'
                            }
                        }
                    },
                    smooth: true,
                    xAxisIndex: 1,
                    yAxisIndex: 1,
                    data: RE
                },
                {
                    name: 'SubgraphIsomorphism',
                    type: 'line',
                    xAxisIndex: 1,
                    yAxisIndex: 1,
                    smooth: true,
                    itemStyle : {
                        normal : {
                            color:'#00FF00',  // 绿色
                            lineStyle:{
                                color:'#00FF00'
                            }
                        }
                    },
                    data: SE
                },
                {
                    name: 'Greedy',
                    type: 'line',
                    xAxisIndex: 1,
                    yAxisIndex: 1,
                    smooth: true,
                    itemStyle : {
                        normal : {
                            color:'#0000FF',  // 蓝色
                            lineStyle:{
                                color:'#0000FF'
                            }
                        }
                    },
                    data: GE
                },
                {
                    name: 'RCRGF',
                    type: 'scatter',
                    xAxisIndex: 0,
                    yAxisIndex: 0,
                    symbolSize: 5,
                    itemStyle : {
                        normal : {
                            color:'#FF0000',  // 红色
                            lineStyle:{
                                color:'#FF0000'
                            }
                        }
                    },
                    data: RA
                },
                {
                    name: 'SubgraphIsomorphism',
                    type: 'scatter',
                    xAxisIndex: 0,
                    yAxisIndex: 0,
                    symbolSize: 5,
                    itemStyle : {
                        normal : {
                            color:'#00FF00',  // 绿色
                            lineStyle:{
                                color:'#00FF00'
                            }
                        }
                    },
                    data: SA
                },
                {
                    name: 'Greedy',
                    type: 'scatter',
                    xAxisIndex: 0,
                    yAxisIndex: 0,
                    symbolSize: 5,
                    itemStyle : {
                        normal : {
                            color:'#0000FF',  // 蓝色
                            lineStyle:{
                                color:'#0000FF'
                            }
                        }
                    },
                    data: GA
                },
                {
                    name: 'RCRGF',
                    type: 'scatter',
                    xAxisIndex: 2,
                    yAxisIndex: 2,
                    symbolSize: 5,
                    itemStyle : {
                        normal : {
                            color:'#FF0000',  // 红色
                            lineStyle:{
                                color:'#FF0000'
                            }
                        }
                    },
                    data: RR
                },
                {
                    name: 'SubgraphIsomorphism',
                    type: 'scatter',
                    xAxisIndex: 2,
                    yAxisIndex: 2,
                    symbolSize: 5,
                    itemStyle : {
                        normal : {
                            color:'#00FF00',  // 绿色
                            lineStyle:{
                                color:'#00FF00'
                            }
                        }
                    },
                    data: SR
                },
                {
                    name: 'Greedy',
                    type: 'scatter',
                    xAxisIndex: 2,
                    yAxisIndex: 2,
                    symbolSize: 5,
                    itemStyle : {
                        normal : {
                            color:'#0000FF',  // 蓝色
                            lineStyle:{
                                color:'#0000FF'
                            }
                        }
                    },
                    data: GR
                },
            ]
        };
        return option;
    }

	function open_chart() {
		 // 基于准备好的dom，初始化echarts实例
		var myChart = echarts.init(document.getElementById('graph'));
        option = {
            grid: [
                {x: '14%', y: '10%', width: '38%', height: '30%'},
                {x2: '0%', y: '27%', width: '40%', height: '50%'},
                {x: '14%', y2: '10%', width: '38%', height: '30%'},
            ],
            tooltip: {
                formatter: '{a}: ({c})'
            },
            xAxis: [
                {gridIndex: 0, boundaryGap: false, data: ['100', '105', '110', '115', '120', '125', '130', '135', '140', '145', '150', '155', '160', '165', '170', '175', '180', '185', '190', '195', '200', '205', '210', '215', '220', '225', '230', '235', '240', '245', '250', '255', '260', '265', '270', '275', '280', '285', '290', '295'], type: 'category'}, // x坐标系0-20
                {gridIndex: 1, boundaryGap: false, data: ['100', '105', '110', '115', '120', '125', '130', '135', '140', '145', '150', '155', '160', '165', '170', '175', '180', '185', '190', '195', '200', '205', '210', '215', '220', '225', '230', '235', '240', '245', '250', '255', '260', '265', '270', '275', '280', '285', '290', '295'], type: 'category'},
                {gridIndex: 2, boundaryGap: false, data: ['100', '105', '110', '115', '120', '125', '130', '135', '140', '145', '150', '155', '160', '165', '170', '175', '180', '185', '190', '195', '200', '205', '210', '215', '220', '225', '230', '235', '240', '245', '250', '255', '260', '265', '270', '275', '280', '285', '290', '295'], type: 'category'},
            ],
            yAxis: [
                {gridIndex: 0, name: 'Acceptance Ratio'}, // y坐标系0-15
                {gridIndex: 1, name: 'Execution Time(ms)'},
                {gridIndex: 2, name: 'RevenueToCost Ratio'},
            ],
            legend: {
                left: 'right',
                data: ['RCRGF', 'SubgraphIsomorphism', 'Greedy']
            },
            series: [
                {
                    name: 'RCRGF',
                    type: 'line',
                    itemStyle : {
                                    normal : {
                                        color:'#FF0000',  // 红色
                                        lineStyle:{
                                            color:'#FF0000'
                                        }
                                    }
                                },
                    smooth: true,
                    xAxisIndex: 1,
                    yAxisIndex: 1,
                    data: [165, 32, 61, 33, 161, 47, 92, 32, 46, 56, 15, 14, 53, 85, 161, 45, 167, 31, 161, 51, 204, 37, 266, 253, 255, 264, 43, 494, 160, 349, 572, 427, 626, 230, 613, 95, 643, 684, 572, 75]
                },
                {
                    name: 'SubgraphIsomorphism',
                    type: 'line',
                    xAxisIndex: 1,
                    yAxisIndex: 1,
                    smooth: true,
                    itemStyle : {
                                    normal : {
                                        color:'#00FF00',  // 绿色
                                        lineStyle:{
                                            color:'#00FF00'
                                        }
                                    }
                                },
                    data: [693, 97, 471, 232, 549, 209, 412, 239, 277, 597, 122, 133, 263, 752, 832, 201, 1113, 210, 1724, 441, 1763, 208, 2281, 2359, 2544, 2312, 265, 2409, 2096, 3515, 3956, 3701, 4662, 1805, 5671, 5229, 4476, 5180, 4466, 7189]
                },
                {
                    name: 'Greedy',
                    type: 'line',
                    xAxisIndex: 1,
                    yAxisIndex: 1,
                    smooth: true,
                    itemStyle : {
                                    normal : {
                                        color:'#0000FF',  // 蓝色
                                        lineStyle:{
                                            color:'#0000FF'
                                        }
                                    }
                                },
                    data: [1246, 592, 836, 740, 1227, 1220, 543, 834, 709, 1320, 923, 994, 1575, 4056, 824, 1285, 1381, 1888, 4536, 2059, 5480, 2635, 2580, 1904, 5563, 2373, 2051, 4807, 5265, 8654, 3392, 9286, 6745, 9245, 7266, 4556, 10501, 12359, 9310, 6993]
                },
                {
                    name: 'RCRGF',
                    type: 'scatter',
                    xAxisIndex: 0,
                    yAxisIndex: 0,
                    symbolSize: 5,
                    itemStyle : {
                                    normal : {
                                        color:'#FF0000',  // 红色
                                        lineStyle:{
                                            color:'#FF0000'
                                        }
                                    }
                                },
                    data: [1.0, 1.0, 1.0, 1.0, 0.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 0.0, 1.0, 1.0, 1.0, 0.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 0.0, 1.0, 1.0, 1.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 1.0, 0.0]
                },
                {
                    name: 'SubgraphIsomorphism',
                    type: 'scatter',
                    xAxisIndex: 0,
                    yAxisIndex: 0,
                    symbolSize: 5,
                    itemStyle : {
                                    normal : {
                                        color:'#00FF00',  // 绿色
                                        lineStyle:{
                                            color:'#00FF00'
                                        }
                                    }
                                },
                    data: [1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0]
                },
                {
                    name: 'Greedy',
                    type: 'scatter',
                    xAxisIndex: 0,
                    yAxisIndex: 0,
                    symbolSize: 5,
                    itemStyle : {
                                    normal : {
                                        color:'#0000FF',  // 蓝色
                                        lineStyle:{
                                            color:'#0000FF'
                                        }
                                    }
                                },
                    data: [0.0, 0.0, 0.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 0.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 0.0, 1.0, 1.0, 1.0, 1.0, 0.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0]
                },
                {
                    name: 'RCRGF',
                    type: 'scatter',
                    xAxisIndex: 2,
                    yAxisIndex: 2,
                    symbolSize: 5,
                    itemStyle : {
                                    normal : {
                                        color:'#FF0000',  // 红色
                                        lineStyle:{
                                            color:'#FF0000'
                                        }
                                    }
                                },
                    data: [0.8768310091160002, 1.0, 1.0, 1.0, 0.9577272914453442, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 0.9773135659095245, 1.0, 1.0, 1.0, 0.837810098889498, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 0.975453980413816, 1.0, 1.0, 0.9573561656359844, 1.0, 0.7879811411243453, 1.0, 1.0, 1.0, 0.8832937594591458, 1.0, 0.9686095092587859, 1.0]
                },
                {
                    name: 'SubgraphIsomorphism',
                    type: 'scatter',
                    xAxisIndex: 2,
                    yAxisIndex: 2,
                    symbolSize: 5,
                    itemStyle : {
                                    normal : {
                                        color:'#00FF00',  // 绿色
                                        lineStyle:{
                                            color:'#00FF00'
                                        }
                                    }
                                },
                    data: [0.7525683260395326, 0.7917368590608915, 0.8039538351407428, 0.8382679217493713, 0.8740957786618635, 0.9332847607982787, 1.0, 0.9682510547334602, 0.9494276526256548, 0.7737975688797041, 0.8130305988129055, 0.7675269907533001, 1.0, 0.8732321748226861, 0.8426774643914018, 0.7147760893095109, 0.8280405684132418, 1.0, 0.8275487404121206, 0.961671470977412, 0.8414793798317852, 0.7202906079939513, 0.7662008140702062, 0.8575069113911976, 0.7795626418138558, 0.8207093611048303, 1.0, 0.9188442031469237, 0.7560773970102088, 0.8625511123461456, 0.777594696953357, 0.8129658488126291, 0.824112371803073, 0.9617186749053784, 0.790211411325106, 0.7538936929822835, 0.8284987166319314, 0.8240287449740317, 0.8166269184547892, 0.8781743543646205]
                },
                {
                    name: 'Greedy',
                    type: 'scatter',
                    xAxisIndex: 2,
                    yAxisIndex: 2,
                    symbolSize: 5,
                    itemStyle : {
                                    normal : {
                                        color:'#0000FF',  // 蓝色
                                        lineStyle:{
                                            color:'#0000FF'
                                        }
                                    }
                                },
                    data: [0.79744879000914, 0.6552685687701466, 0.7767718618817805, 1.0, 0.89982169365546, 0.8722487042651206, 1.0, 0.7572125757465775, 0.9792824070334966, 0.7981024978801948, 1.0, 1.0, 0.6425670793539268, 0.7878699979261227, 1.0, 1.0, 1.0, 0.6747510135726988, 0.7451044668102556, 1.0, 0.6849878499917366, 0.5159249588996419, 1.0, 1.0, 0.7644208361061515, 1.0, 1.0, 0.9027134374113528, 1.0, 0.7705438278311446, 1.0, 0.9954531110946646, 0.947552117636702, 0.9791509569136412, 0.9987749263980914, 0.9278858571699211, 0.9512263837582734, 0.9061423266569144, 0.832266191617621, 0.9561682564591956]
                },
            ]
        };

		// 使用刚指定的配置项和数据显示图表。
		myChart.setOption(option);
	}
</script>
</html>